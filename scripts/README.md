# Инструменты администрирования Supabase для FitBrutal

В этой папке находятся утилиты для администрирования базы данных Supabase, диагностики и исправления ошибок.

## Подготовка к использованию

1. Установите Node.js (версия 16 или выше)
2. Установите зависимости:
   ```bash
   cd scripts
   npm install
   ```
3. Убедитесь, что в корне проекта есть файл `.env` с правильными переменными окружения:
   ```
   EXPO_PUBLIC_SUPABASE_URL="https://ваш-проект.supabase.co"
   EXPO_PUBLIC_SUPABASE_ANON_KEY="ваш-anon-ключ"
   EXPO_PUBLIC_SUPABASE_SERVICE_ROLE_KEY="ваш-service-role-ключ"
   ```

## Доступные скрипты

### Скрипт администрирования `supabase-admin.js`

Этот скрипт предоставляет следующие команды:

- **Проверка подключения:**
  ```bash
  npm run check
  ```

- **Получение списка пользователей:**
  ```bash
  npm run users
  ```

- **Исправление триггера создания пользователей:**
  ```bash
  npm run fix-trigger
  ```

- **Исправление настроек таблиц:**
  ```bash
  npm run fix-tables
  ```

### Скрипт тестирования регистрации `test-registration.js`

Этот скрипт позволяет протестировать процесс регистрации и выявить ошибки:

- **Тестирование регистрации:**
  ```bash
  npm run test-register
  ```

- **Очистка тестовых пользователей:**
  ```bash
  npm run cleanup
  ```

## Решение проблемы регистрации

Если вы столкнулись с ошибкой "Database error saving new user", выполните следующие действия:

1. Запустите проверку подключения:
   ```bash
   npm run check
   ```

2. Примените исправление триггера:
   ```bash
   npm run fix-trigger
   ```

3. Исправьте настройки таблиц:
   ```bash
   npm run fix-tables
   ```

4. Протестируйте регистрацию нового пользователя:
   ```bash
   npm run test-register
   ```

5. После тестирования удалите тестовых пользователей:
   ```bash
   npm run cleanup
   ```

## Безопасность

⚠️ **ВНИМАНИЕ!** Эти скрипты используют service role ключ Supabase с полным доступом к вашей базе данных. Никогда не публикуйте этот ключ или сгенерированные токены. Используйте эти инструменты только в доверенной среде разработки. 